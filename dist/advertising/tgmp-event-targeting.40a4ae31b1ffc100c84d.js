"use strict";(self.cmlsAmpUtils=self.cmlsAmpUtils||[]).push([[103],{5:function(t,e,i){i.r(e),i(560);var a=JSON.parse('{"scriptName":"TGMP EVENT TARGETING","nameSpace":"tgPlayerEventTargeting","version":"0.4"}');((t,e)=>{const{scriptName:i,nameSpace:s,version:n}=a,{waitForPlayer:r}=t._CMLS.libs.playerTools,{throttle:l}=t._CMLS.libs.lodash,c=new t._CMLS.Logger(`${i} ${n}`);class g{initTime=null;initTimeout=null;active=!1;__PWM__;lastTrack={artist:null,title:null};constructor(){t.self?.__PWM__?.events?.mediaSession?.setTrack?(this.initTime=new Date((new Date).getTime()+35e3),this.active=!0,this.__PWM__=t.self.__PWM__,this.__PWM__.events.mediaSession.setTrack.push(l((t=>{this.handleTrackChange.call(this,t)}),1e3,{leading:!1,trailing:!0}))):c.info("__PWM__ event tracking not available, cannot track events.")}handleTrackChange(e){if(t._CMLS.adTag){if(e?.title&&e.title!==this.lastTrack.title){this.initTimeout&&(clearTimeout(this.initTimeout),this.initTimeout=null);const i=t._CMLS.adTag;c.debug("Caught track change.",e),i.queue((()=>{this.lastTrack.title=e.title;const t=this.sanitizeForGPT(e.title);if(c.debug("Setting webplayer-title target",e.title,t),i.setTargeting("webplayer-title",t),e?.artist&&e?.artist!==this.lastTrack.artist){this.lastTrack.artist=e.artist;const t=this.sanitizeForGPT(e.artist);c.debug("Setting webplayer-artist target",e.artist,t),i.setTargeting("webplayer-artist",t)}}))}}else c.warn("Track change event triggered without adTag interface.",e)}sanitizeForGPT(t){return t.replace(/["'=!+#*~;^()<>\[\],&]/g,"-")}}r().then((()=>{t._CMLS[s]?.active||(t._CMLS.adTag?t._CMLS[s]=new g:t.addEventListener("cmls-adtag-loaded",(()=>{t._CMLS[s]=new g})))}))})(window.self)}}]);