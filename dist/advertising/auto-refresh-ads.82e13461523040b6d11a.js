"use strict";(self.cmlsAmpUtils=self.cmlsAmpUtils||[]).push([[58],{6163:function(e,t,s){s.r(t),s(560);var i=s(363);((e,t)=>{const{scriptName:s,nameSpace:o,version:l,viewablePercent:r,defaultRefreshInMinutes:n,ALWAYS_REFRESH_POS:a=[]}=i,E=new e._CMLS.Logger(`${s} ${l}`);e._CMLS.autoRefreshAdsExclusion=e._CMLS?.autoRefreshAdsExclusion||[],e._CMLS.autoRefreshAdsExclusion.push=(...e)=>(e.forEach((e=>{t.includes(e)?E.warn("Attempted to add duplicate item to autoRefreshAdsExclusion list.",e):(E.info("New ID added to exclusion list",e),Array.prototype.push.apply(t,[e]))})),t.length);const h=()=>{e._CMLS[o]=new class{log=E;every=n;globalConditions={DISABLED:"Auto-Refresh-Ads is disabled.",PAUSED:"Auto-Refresh-Ads is paused.",RUNNING:"Auto-Refresh-Ads is running."};slotConditions={OK:"Slot is good to refresh.",NEVER:"Slot is set to never refresh.",TARGET_NEVER:`Slot has ${this.TARGET_NEVER_REFRESH} targeting.`,ALWAYS:"Slot is set to always refresh.",TARGET_ALWAYS:`Slot has ${this.TARGET_ALWAYS_REFRESH} targeting.`,EXCLUDED:"Slot is excluded by autoRefreshAdsExclusion.",DISABLED:"Refresh is disabled for this slot.",HIDDEN:"Slot is not currently viewable."};TARGET_REFRESH_KEY="refresh";TARGET_ALWAYS_REFRESH_KEY="always_refresh";TARGET_NEVER_REFRESH_KEY="never_refresh";TARGET_TRUE="true";timers=new Map;interval=null;constructor(t=n){if(this.every=t,this.checkGlobalConditions()!==this.globalConditions.RUNNING)return!1;const s=e._CMLS.adTag;return E.debug("Adding impressionViewable listener. Refresh timer will be set per-slot once an impression is delivered."),s.addListener("impressionViewable",(e=>{const t=e.slot;E.info("Impression viewable",t.getTargeting("pos"),t.getSlotElementId(),t.getTargeting(this.TARGET_REFRESH_KEY)),this.slotIsExcluded(t)||this.slotHasRefreshKey(t)||this.initSlotTimer(t)})),s.getSlots().forEach((e=>{this.slotHasRefreshKey(e)||!this.slotIsAlwaysRefresh(e)||this.slotIsExcluded(e)||this.initSlotTimer(e)})),s.addListener("slotRenderEnded",(e=>{const t=e.slot;this.slotHasRefreshKey(t)||!this.slotIsAlwaysRefresh(t)||this.slotIsExcluded(t)||this.initSlotTimer(t)})),this.interval=setInterval((()=>{this.tick.call(this)}),1e3),this}checkGlobalConditions(){const{DISABLED:t,PAUSED:s,RUNNING:i}=this.globalConditions,o=e._CMLS?.autoReload;return e.DISABLE_AUTO_REFRESH_ADS?(E.info("DISABLE_AUTO_REFRESH_ADS is set. Ads will not refresh."),t):o?.active&&o.settings.timeout<2*this.every?(E.warn("Auto-Reload-Page timer is less than 2x Auto-Refresh-Ads timer. Ads will not refresh"),t):i}slotIsExcluded(t){return!!e._CMLS.autoRefreshAdsExclusion.includes(t.getSlotElementId())&&this.slotConditions.EXCLUDED}slotIsAlwaysRefresh(e){const{ALWAYS:t,TARGET_ALWAYS:s}=this.slotConditions,i=e.getTargeting("pos");return e.getTargeting(this.TARGET_ALWAYS_REFRESH_KEY).includes(this.TARGET_TRUE)?s:!!a.some((e=>i.includes(e)))&&t}slotHasRefreshKey(e){return e.getTargeting(this.TARGET_REFRESH_KEY).includes(this.TARGET_TRUE)}initSlotTimer(e){const t=e.getSlotElementId(),s=e.getTargeting("pos"),i=new Date;i.setSeconds(i.getSeconds()+Math.max(i.getMilliseconds()/1e3));const o=new Date(i.getTime()+6e4*this.every);this.timers.has(e)||(E.info("Setting refresh timer on slot.",{pos:s,id:t},o.toLocaleString()),this.timers.set(e,o),e.setTargeting(this.TARGET_REFRESH_KEY,this.TARGET_TRUE))}deleteTimer(e){this.timers.has(e)&&this.timers.delete(e)}tick(){const t=new Date;t.getTime()%(6e4*this.every/4)<1e3&&E.debug("Tick",t.toLocaleString());const s=[];this.timers.forEach(((e,i)=>{const o=i.getSlotElementId(),l=i.getTargeting("pos");t>=e&&(E.debug("Queueing for refresh",{pos:l,id:o}),this.deleteTimer(i),i.getTargeting(this.TARGET_REFRESH_KEY)&&i.clearTargeting(this.TARGET_REFRESH_KEY),s.push(i))})),s.length&&(E.info(`Refreshing ${s.length} slots.`,e._CMLS.adTag.listSlotData(s)),e._CMLS.adTag.refresh(s))}destroy(){this.interval&&(clearInterval(this.interval),this.interval=null)}},E.debug("Initialized.")};e._CMLS.adTag?e._CMLS.adTag.queue((()=>{h()})):e.addEventListener("cmls-adtag-loaded",(()=>{e._CMLS.adTag.queue((()=>{h()}))}))})(window.self)}}]);