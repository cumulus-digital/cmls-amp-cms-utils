"use strict";(self.cmlsAmpUtils=self.cmlsAmpUtils||[]).push([[788],{444:function(e,s,t){t.r(s),t(3248);var i=t(7262);((e,s)=>{const{scriptName:t,nameSpace:o,version:l,viewablePercent:n,defaultRefreshInMinutes:r,ALWAYS_REFRESH_POS:E=[]}=i,{Logger:a}=e.__CMLSINTERNAL.libs,h=new a(`${t} ${l}`);e.__CMLSINTERNAL?.initAutoRefreshAdsExclusion||(e.__CMLSINTERNAL.initAutoRefreshAdsExclusion=()=>{e._CMLS.autoRefreshAdsExclusion=e._CMLS?.autoRefreshAdsExclusion||[],e._CMLS.autoRefreshAdsExclusion?._push||(e._CMLS.autoRefreshAdsExclusion._push=e._CMLS.autoRefreshAdsExclusion.push,e._CMLS.autoRefreshAdsExclusion.push=(...e)=>(e.forEach((e=>{s.includes(e)?h.warn("Attempted to add duplicate item to autoRefreshAdsExclusion list.",e):(h.info("New ID added to exclusion list",e),Array.prototype.push.apply(s,[e]))})),s.length))}),e.__CMLSINTERNAL.initAutoRefreshAdsExclusion(),e.__CMLSINTERNAL.clearAutoRefreshAdsExclusion=()=>{delete e._CMLS.autoRefreshAdsExclusion,e.__CMLSINTERNAL.initAutoRefreshAdsExclusion()};const d=()=>{e.__CMLSINTERNAL[o]=new class{log=h;every=r;globalConditions={DISABLED:"Auto-Refresh-Ads is disabled.",PAUSED:"Auto-Refresh-Ads is paused.",RUNNING:"Auto-Refresh-Ads is running."};slotConditions={OK:"Slot is good to refresh.",NEVER:"Slot is set to never refresh.",TARGET_NEVER:`Slot has ${this.TARGET_NEVER_REFRESH} targeting.`,ALWAYS:"Slot is set to always refresh.",TARGET_ALWAYS:`Slot has ${this.TARGET_ALWAYS_REFRESH} targeting.`,EXCLUDED:"Slot is excluded by autoRefreshAdsExclusion.",DISABLED:"Refresh is disabled for this slot.",HIDDEN:"Slot is not currently viewable."};TARGET_REFRESH_KEY="refresh";TARGET_ALWAYS_REFRESH_KEY="always_refresh";TARGET_NEVER_REFRESH_KEY="never_refresh";TARGET_TRUE="true";timers=new Map;interval=null;constructor(s=r){if(this.every=s,this.checkGlobalConditions()!==this.globalConditions.RUNNING)return!1;const t=e.__CMLSINTERNAL.adTag;return h.debug("Adding impressionViewable listener. Refresh timer will be set per-slot once an impression is delivered."),t.addListener("impressionViewable",(e=>{const s=e.slot;h.debug("Impression viewable",s.getTargeting("pos"),s.getSlotElementId(),s.getTargeting(this.TARGET_REFRESH_KEY)),this.slotIsExcluded(s)||this.slotHasRefreshKey(s)||this.initSlotTimer(s)})),t.getSlots().forEach((e=>{this.slotHasRefreshKey(e)||!this.slotIsAlwaysRefresh(e)||this.slotIsExcluded(e)||this.initSlotTimer(e)})),t.addListener("slotRenderEnded",(e=>{const s=e.slot;this.slotHasRefreshKey(s)||!this.slotIsAlwaysRefresh(s)||this.slotIsExcluded(s)||this.initSlotTimer(s)})),this.interval=setInterval((()=>{this.tick.call(this)}),1e3),this}checkGlobalConditions(){const{DISABLED:s,PAUSED:t,RUNNING:i}=this.globalConditions,o=e.__CMLSINTERNAL?.autoReload;return e.DISABLE_AUTO_REFRESH_ADS?(h.warn("window.DISABLE_AUTO_REFRESH_ADS is set. Ads will not refresh."),s):o?.active&&o.settings.timeout<2*this.every?(h.warn("Auto-Reload-Page timer is less than 2x Auto-Refresh-Ads timer. Ads will not refresh"),s):i}slotIsExcluded(s){return void 0===e._CMLS.autoRefreshAdsExclusion&&e.__CMLSINTERNAL?.initAutoRefreshAdsExclusion(),!!e._CMLS.autoRefreshAdsExclusion.includes(s.getSlotElementId())&&this.slotConditions.EXCLUDED}slotIsAlwaysRefresh(e){const{ALWAYS:s,TARGET_ALWAYS:t}=this.slotConditions,i=e.getTargeting("pos");return e.getTargeting(this.TARGET_ALWAYS_REFRESH_KEY).includes(this.TARGET_TRUE)?t:!!E.some((e=>i.includes(e)))&&s}slotHasRefreshKey(e){return e.getTargeting(this.TARGET_REFRESH_KEY).includes(this.TARGET_TRUE)}initSlotTimer(e){const s=e.getSlotElementId(),t=e.getTargeting("pos"),i=new Date;i.setSeconds(i.getSeconds()+Math.max(i.getMilliseconds()/1e3));const o=new Date(i.getTime()+6e4*this.every);this.timers.has(e)||(h.debug("Setting refresh timer on slot.",{pos:t,id:s},o.toLocaleString()),this.timers.set(e,o),e.setTargeting(this.TARGET_REFRESH_KEY,this.TARGET_TRUE))}deleteTimer(e){this.timers.has(e)&&this.timers.delete(e)}tick(){const s=new Date;s.getTime()%(6e4*this.every/4)<1e3&&h.debug("Tick",s.toLocaleString());const t=[];this.timers.forEach(((e,i)=>{const o=i.getSlotElementId(),l=i.getTargeting("pos");s>=e&&(h.debug("Queueing for refresh",{pos:l,id:o}),this.deleteTimer(i),i.getTargeting(this.TARGET_REFRESH_KEY)&&i.clearTargeting(this.TARGET_REFRESH_KEY),t.push(i))})),t.length&&(h.info(`Refreshing ${t.length} slots.`,e.__CMLSINTERNAL.adTag.listSlotData(t)),e.__CMLSINTERNAL.adTag.refresh(t))}destroy(){this.interval&&(clearInterval(this.interval),this.interval=null)}},h.debug("Initialized.")};e.__CMLSINTERNAL.adTag?e.__CMLSINTERNAL.adTag.queue((()=>{d()})):e.addEventListener("cmls-adtag-loaded",(()=>{e.__CMLSINTERNAL.adTag.queue((()=>{d()}))}))})(window.self)}}]);