"use strict";(self.cmlsAmpUtils=self.cmlsAmpUtils||[]).push([[8],{1208:function(t,e,i){i.r(e),i(3248);var a=JSON.parse('{"scriptName":"TGMP EVENT TARGETING","nameSpace":"tgPlayerEventTargeting","version":"0.4"}');((t,e)=>{const{scriptName:i,nameSpace:s,version:n}=a,{Logger:r,playerTools:l,lodash:T}=t.__CMLSINTERNAL.libs,{waitForPlayer:c}=l,{throttle:_}=T,g=new r(`${i} ${n}`);class o{initTime=null;initTimeout=null;active=!1;__PWM__;lastTrack={artist:null,title:null};constructor(){t.self?.__PWM__?.events?.mediaSession?.setTrack?(this.initTime=new Date((new Date).getTime()+35e3),this.active=!0,this.__PWM__=t.self.__PWM__,this.__PWM__.events.mediaSession.setTrack.push(_((t=>{this.handleTrackChange.call(this,t)}),1e3,{leading:!1,trailing:!0}))):g.info("__PWM__ event tracking not available, cannot track events.")}handleTrackChange(e){if(t.__CMLSINTERNAL.adTag){if(e?.title&&e.title!==this.lastTrack.title){this.initTimeout&&(clearTimeout(this.initTimeout),this.initTimeout=null);const i=t.__CMLSINTERNAL.adTag;g.debug("Caught track change.",e),i.queue((()=>{this.lastTrack.title=e.title;const t=this.sanitizeForGPT(e.title);if(g.debug("Setting webplayer-title target",e.title,t),i.setTargeting("webplayer-title",t),e?.artist&&e?.artist!==this.lastTrack.artist){this.lastTrack.artist=e.artist;const t=this.sanitizeForGPT(e.artist);g.debug("Setting webplayer-artist target",e.artist,t),i.setTargeting("webplayer-artist",t)}}))}}else g.warn("Track change event triggered without adTag interface.",e)}sanitizeForGPT(t){return t.replace(/["'=!+#*~;^()<>\[\],&]/g,"-")}}c().then((()=>{t.__CMLSINTERNAL[s]?.active||(t.__CMLSINTERNAL.adTag?t.__CMLSINTERNAL[s]=new o:t.addEventListener("cmls-adtag-loaded",(()=>{t.__CMLSINTERNAL[s]=new o})))}))})(window.self)}}]);